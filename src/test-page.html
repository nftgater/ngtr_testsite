
<html lang="en">
<head>
	<title>Test Page</title>
	 <!-- add bootstrap css file -->

	 <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css">
	 <link rel="stylesheet" type="text/css" href="../css/main.css">
	 <link rel="stylesheet" type="text/css" href="/public/3P.css">

</head>
<body>





  <!-- navbar -->

  <nav class="navbar navbar-expand-lg ">
	
	
	<ul class="navbar-nav mr-4">
		
	 
   
		<li class="nav-item">
		  <a class="nav-link " data-value="home" href="/">
		  HOME</a>
		</li>
		<li class="nav-item">
			<a class="nav-link" data-value="Test Page" href="/test-page.html">Gate Tester</a>
		  </li>

		  <li class="nav-item">
			<a class="nav-link " data-value="unnimagnum" href="/creators/unnimagnum.html">Unnimagnum</a>
		</li>
	  </ul>
  
</div>
</nav>
<header class="header ">
  <div class="overlay" style="position:absolute;min-height: 100%;min-width: 100%;left:0;top:0;"></div>
   <div class="container">
   	  <div class="description ">
		<div class="centerbox">
  	<h1>GATR Test Page</h1>
  		<p>
  		This website serves as a testing ground for the GATR token gating service. Imagine this page is your website, where your GATR copy/paste script lives. </p>
  		<!-- BOOKMARK: Implement OPSv2.JS, overwrite this script when done (being edited in the API SDK arbitrarily)-->


<!-- ON-PAGE-SCRIPT --> 
<script async type="module">  // NOTE: This OPS script modified for Vue3
	import libz from "https://ngtr.nyc3.digitaloceanspaces.com/opsv2.js" // bookmark: failed trying to load a local version.
	import { Encoder } from 'https://cdn.jsdelivr.net/npm/qrcode@1.5.3/lib/browser.min.js' // was: https://cdn.jsdelivr.net/npm/@nuintun/qrcode@latest // was: '../node_modules/@nuintun/qrcode' // bookmark: would ONLY work for test site. // bookmark: debugging QR payload types
	try {

		// Style importing Start
		var cssId = 'myCss';  // you could encode the css path itself to generate id..
		console.log("DEBUG: testing CSS injection mid-script for OPS")
		if (!document.getElementById(cssId))
		{
			var head  = document.getElementsByTagName('head')[0];
			var link  = document.createElement('link');
			link.id   = cssId;
			link.rel  = 'stylesheet';
			link.type = 'text/css';
			link.href = 'https://ngtr.nyc3.digitaloceanspaces.com/3P.css';
			link.media = 'all';
			head.appendChild(link);
		}
		// Style importing end

		document.getElementById("ops_start").addEventListener("click", () => {  
		let callback = window.location;
		window.location = `https://janus-auth.vercel.app/?callback=${callback}`; // on J2 site it is: https%3A%2F%2Fwww.jesus-2.com%2Fwatch
		}) 
		let auth = libz.g_A()
		
		if(auth) { 
			document.getElementById("statusconsole").innerHTML = "&#9989; Loading gate payload..."
			let resp_GE = await libz.g_E(auth); 
			console.log("debug: resp_GE")
			console.log(resp_GE)

			///// POST PROCESSING AND PASSTHROUGH
			try {
				if(resp_GE[0] == "PASS_QR") { // not gonna work.
					console.log("QR passthrough!!!")
					console.log(resp_GE[1])
					let qrPld = resp_GE[1]

					const qrcode = new Encoder(); // bookmark: lib for Encoder imported by test-page.html, no idea if it will work
					qrcode.write(pld);
					qrcode.make();
					console.log("QR made?")
					console.log(qrcode.toDataURL());
					let qr_img = qrcode.toDataURL();
					document.getElementById("p_inj").innerHTML = `<p>Gate Results</p><img width="200px" src="${qr_img}" />`

					statusUI(`Gating tech made by <a href='https://nftgater.vercel.app' />NFT Gater</a>`)
					let pinj = document.getElementById('p_inj')
					let redo = document.createElement('a')
					redo.classList.add('statusconsole')
					redo.textContent = "Start Over"
					redo.title = "Your existing gate auth will be kept as a cookie and you can reverify to select a different gate."
					let cu = window.location.href;
					let url = new URL(cu)
					const cleanURL = url.origin + url.pathname;
					redo.href=`https://janus-auth.vercel.app/?callback=${cleanURL}`
					pinj.insertAdjacentElement('afterend', redo)
		

					
				}
			}catch(err) {
				console.log("caught:")
				console.log(err)
				libz.drawBtn();
				document.getElementById("statusconsole").innerHTML = "&#9889; Authenticate wallet to begin." 
			}
		} else { 
			libz.drawBtn(); 
			document.getElementById("statusconsole").innerHTML = "&#9889; Authenticate wallet to begin." 
		} 
	}catch(err) {
		console.log("caught in ops:")
		console.log(err)
	}
	
	</script> 
	<div id="authbox"> 
	<button id="ops_start" style="display:none;">Token Portal</button> 
	<div id="statusconsole" class="statusconsole">Initializing...</div><div id="p_inj"></div>
	
	</div> 
	<!-- ON-PAGE-SCRIPT END -->
 

  	
  </div>
   </div>
</div>
  
</header>

<footer class="footer mt-auto py-3" style="background:#052c4d;position:absolute;bottom:-50px;width:100%;">
	<div class="container">
		<p class="text-center text-white lead">Copyright &copy; <script type="text/javascript">
			document.write(new Date().getFullYear());
		  </script> Wyrd Ventures</p>
	  
	</div>
  </footer>

  <script type="text/javascript" src="./js/jquery.min.js"></script>
  <script type="text/javascript" src="./js/bootstrap.min.js"></script>
  <script type="text/javascript" src='./js/index.js'></script>
 
</body>
</html>